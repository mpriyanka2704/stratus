!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","angular-material","masonry","angular-file-upload","stratus.components.tag","stratus.components.search","stratus.components.pagination","stratus.components.mediaDetails","stratus.components.mediaShortDetails","stratus.components.mediaUploader","stratus.directives.singleClick","stratus.directives.src","stratus.services.registry","stratus.services.media"],factory):factory(root.Stratus,root._,root.angular)}(this,function(Stratus,_,angular){const min=Stratus.Environment.get("production")?".min":"",name="mediaLibrary";Stratus.Modules.ngFileUpload=!0,Stratus.Components.MediaLibrary={bindings:{ngModel:"=",isSelector:"<",mediaSelectorDraggedFiles:"="},controller:function($scope,$attrs,Registry,$mdDialog,media){const $ctrl=this;function openUploader(ngfMultiple,files,invalidFiles){$mdDialog.show({attachTo:angular.element(document.querySelector("#listContainer")),controller:function(scope,collection,ngfMultiple,draggedFiles,invalidFiles){scope.collection=collection,scope.ngfMultiple=ngfMultiple,scope.draggedFiles=draggedFiles,scope.invalidFiles=invalidFiles},template:'<stratus-media-uploader collection="collection" ngf-multiple="ngfMultiple" dragged-files="draggedFiles" invalid-files="invalidFiles"></stratus-media-uploader>',clickOutsideToClose:!1,focusOnOpen:!0,autoWrap:!0,multiple:!0,locals:{collection:$scope.collection,ngfMultiple:ngfMultiple,draggedFiles:files,invalidFiles:invalidFiles}}).then(function(){media.getMedia($scope)})}$ctrl.uid=_.uniqueId(_.camelToSnake(name)+"_"),Stratus.Instances[$ctrl.uid]=$scope,$scope.elementId=$attrs.elementId||$ctrl.uid,Stratus.Internals.CssLoader(Stratus.BaseUrl+Stratus.BundlePath+"components/"+name+min+".css"),$scope.initialized=!1,$ctrl.$onInit=function(){$ctrl.openUploader=openUploader,$ctrl.registry=new Registry,$ctrl.registry.fetch({target:$attrs.target||"Media",id:null,manifest:!1,decouple:!0,api:{limit:_.isJSON($attrs.limit)?JSON.parse($attrs.limit):30}},$scope)},$scope.getThumbnailImgOfVideo=function(mediaData){return media.getThumbnailImgOfVideo(mediaData)},$scope.showDetails=function(media){$mdDialog.show({attachTo:angular.element(document.querySelector("#listContainer")),controller:function($scope,media,collection){$scope.media=media,$scope.collection=collection},template:'<stratus-media-details media="media" collection="collection"></stratus-media-details>',clickOutsideToClose:!1,focusOnOpen:!0,autoWrap:!0,locals:{media:media,collection:$scope.collection}})},$scope.deleteMedia=function(fileId){Stratus.Environment.get("production")||console.log(fileId),$mdDialog.show($mdDialog.confirm().title("DELETE MEDIA").textContent("Are you sure you want to permanently delete this from your library? You may get broken images if any content still uses this image.").multiple(!0).ok("Yes").cancel("No")).then(function(){media.deleteMedia(fileId).then(function(response){"SUCCESS"===response.data.meta.status[0].code?media.getMedia($scope):$mdDialog.show($mdDialog.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!1).title("Error").multiple(!0).textContent(response.data.meta.status[0].message).ok("Ok"))},function(rejection){Stratus.Environment.get("production")||console.log(rejection.data)})})},$scope.mediaSelectorAddOrRemoveFile=function(media){$ctrl.mediaSelectorDraggedFiles&&(!0===media.selectedClass?($ctrl.mediaSelectorDraggedFiles.splice(_.findIndex($ctrl.mediaSelectorDraggedFiles,function(mediaSelectorDraggedFile){return mediaSelectorDraggedFile.id===media.id}),1),media.selectedClass=!1):($ctrl.mediaSelectorDraggedFiles.push(media),media.selectedClass=!0))},$scope.$watch("collection.models",function(data){if(!_.isUndefined(data)&&$ctrl.mediaSelectorDraggedFiles&&$ctrl.mediaSelectorDraggedFiles.length>0)for(let i=0;i<$ctrl.mediaSelectorDraggedFiles.length;i++){let addedFile=$ctrl.mediaSelectorDraggedFiles[i];for(let j=0;j<$scope.collection.models.length;j++){let media=$scope.collection.models[j];addedFile.id===media.data.id&&(media.data.selectedClass=!0)}}}),$scope.$on("mediaSelectorRemoveSelectedFile",function(evt,removedFileId){let removedFileIndex=_.findIndex($scope.collection.models,function(media){return removedFileId===media.data.id});-1!==removedFileIndex&&($scope.collection.models[removedFileIndex].data.selectedClass=!1)})},templateUrl:Stratus.BaseUrl+Stratus.BundlePath+"components/"+name+min+".html"}});