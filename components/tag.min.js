!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","jquery","angular","angular-material","stratus.services.utility","stratus.services.media"],factory):factory(root.Stratus,root._,root.jQuery,root.angular)}(this,function(Stratus,_,jQuery,angular){Stratus.Components.Tag={bindings:{ngModel:"=",collection:"<"},controller:function($scope,$parse,$attrs,utility,media,$location,$rootScope){utility.componentInitializer(this,$scope,$attrs,"tag",!0);let $ctrl=this;$ctrl.selectedChips=[],$ctrl.collection=[],$ctrl.queryText="",$scope.$watch("$ctrl.ngModel",function(items){$ctrl.selectedChips=items||[]}),$scope.$watch("$ctrl.collection",function(data){$ctrl.collection=data}),$scope.$watch("$ctrl.selectedChips",function(newData,oldData){if(oldData.length>0){let dataRes={};if(dataRes.tags=$ctrl.selectedChips,void 0!==$rootScope.$$childHead.collection)"Media"===$rootScope.$$childHead.collection.target&&void 0!==$rootScope.mediaId&&media.updateMedia($rootScope.mediaId,dataRes).then(function(response){media.fetchOneMedia($rootScope.mediaId)},function(rejection){console.error("tag:",rejection)});else{let contentId=$location.absUrl().split("?id=")[1];if(contentId){(function(fileId,data,apiUrl){return utility.sendRequest(data,"PUT",apiUrl+"/"+fileId)})(contentId,dataRes,$rootScope.$$childHead.data.urlRoot).then(function(response){$rootScope.$$childHead.data.changed=!1})}}}}),$ctrl.queryData=function(){let results=$ctrl.collection.filter($ctrl.queryText);return $scope.status=!0,Promise.resolve(results).then(function(value){let returnArr=value.filter(function(item){if(!$ctrl.queryText||""===$ctrl.queryText&&void 0===$ctrl.queryText)$scope.status=!0;else{let i;for(i=0;i<$ctrl.selectedChips.length;i++)item.name.toUpperCase()===$ctrl.queryText.toUpperCase()?($scope.status=!0,$ctrl.selectedChips[i].name.toUpperCase()===$ctrl.queryText.toUpperCase()?($ctrl.queryText=null,jQuery("input").blur(),$rootScope.$$childHead.data.meta.data.status=[{code:"INVALID",message:"You have already selected a tag with that name",origin:"name"}],$rootScope.$$childHead.data.error=!0,$scope.status=!0):($rootScope.$$childHead.data.error=!1,$scope.status=!0)):$scope.status=!1}return $scope.status});return $ctrl.selectedChips.forEach(predata=>{let resultData=returnArr.find(mainArr=>mainArr.name===predata.name);void 0!==resultData&&(returnArr=returnArr.filter(function(itemNew){return itemNew.name!==resultData.name}))}),returnArr})},$ctrl.transformChip=function(chip){return angular.isObject(chip)?chip:{name:chip}},$ctrl.createTag=function(query){let data={name:query};media.createTag(data).then(function(response){utility.getStatus(response).code===utility.RESPONSE_CODE.success?($ctrl.selectedChips.push(response.data.payload),$rootScope.$$childHead.data.save()):($rootScope.$$childHead.data.meta.data.status=response.data.meta.status,$rootScope.$$childHead.data.error=!0)}),$ctrl.queryText=null,jQuery("input").blur()}},templateUrl:Stratus.BaseUrl+Stratus.BundlePath+"components/tag"+(Stratus.Environment.get("production")?".min":"")+".html"}});